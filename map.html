<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äº’å‹•åœ°åœ– - åé„‰æ•™è‚²è³‡æº</title>
<link rel="stylesheet" href="css/style.css">
<style>
/* ===== map.html é•·æ¢ç¾åŒ– ===== */
#dataPanel .progress-bar {
  width: 100%;
  background: rgba(255,255,255,0.1);
  border-radius: 12px;
  height: 28px;
  margin-bottom: 12px;
  overflow: hidden;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

#dataPanel .progress-fill {
  height: 100%;
  border-radius: 12px;
  text-align: right;
  padding-right: 10px;
  line-height: 28px;
  color: #fff;
  font-weight: bold;
  transition: width 0.5s ease;
  background: linear-gradient(90deg, #ff4c4c, #ff1a1a);
}

#dataPanel .progress-fill.student {
  background: linear-gradient(90deg, #4facfe, #00f2fe);
}

#dataPanel .progress-fill.graduate {
  background: linear-gradient(90deg, #28a745, #85e085);
}

#dataPanel .progress-fill.city {
  background: linear-gradient(90deg, #f093fb, #f5576c);
}

#dataPanel label {
  margin-bottom: 4px;
  display: block;
  font-weight: 500;
}

#dataPanel input[type=number] {
  width: 60px;
  margin-left: 10px;
  padding: 2px 6px;
  border-radius: 6px;
  border: 1px solid #555;
  background: #1f1f2f;
  color: #fff;
}
</style>
</head>
<body>

<main class="map-main">
  <!-- å·¦å´è³‡è¨Šå¡ç‰‡ -->
  <section class="card" id="infoCard">
    <h2>äº’å‹•åœ°åœ–</h2>
    <label for="countySelect">é¸æ“‡ç¸£å¸‚ï¼š</label>
    <select id="countySelect">
      <option value="yunlin">é›²æ—ç¸£</option>
      <option value="taipei">å°åŒ—å¸‚</option>
    </select>
    <p id="modeText">é»æ“Šåœ°åœ–ä¸Šçš„å­¸æ ¡æŸ¥çœ‹è³‡æ–™</p>
    <div id="dataPanel" class="info-card"></div>
    <button id="compareBtn">é–‹å§‹æ¯”å°æ¨¡å¼</button>
  </section>

  <!-- å³å´åœ°åœ– -->
  <section class="map-container" id="mapContainer">
    <!-- JS å‹•æ…‹è¼‰å…¥åœ°åœ–èˆ‡å­¸æ ¡é» -->
  </section>
</main>

<!-- å°è¦½åˆ— -->
<nav class="navbar">
  <ul>
    <li><a href="index.html">ğŸ </a></li>
    <li><a href="about.html">ğŸ¯</a></li>
    <li><a href="data.html">ğŸ“Š</a></li>
    <li><a href="map.html" class="active">ğŸ—ºï¸</a></li>
    <li><a href="feedback.html">ğŸ’¬</a></li>
  </ul>
</nav>

<script>
  const schools = {
    yunlin: [
      { name: "è²¡åœ˜æ³•äººç¾©å³°é«˜ä¸­", county: "é›²æ—ç¸£", teacher: 74, student: 543, graduates: 216, pos: { top: "30%", left: "75%" }, type: "rural" },
      { name: "åœ‹ç«‹è™å°¾è¾²å·¥", county: "é›²æ—ç¸£", teacher: 149, student: 1139, graduates: 317, pos: { top: "40%", left: "50%" }, type: "rural" }
    ],
    taipei: [
      { name: "å¸‚ç«‹å»ºåœ‹ä¸­å­¸", county: "å°åŒ—å¸‚", teacher: 260, student: 2821, graduates: 892, pos: { top: "65%", left: "35%" }, type: "city" },
      { name: "å¸‚ç«‹å—æ¸¯é«˜ä¸­", county: "å°åŒ—å¸‚", teacher: 188, student: 1015, graduates: 315, pos: { top: "65%", left: "65%" }, type: "city" }
    ]
  };
  
  let compareMode = false;
  let selectedRural = null;
  let selectedCity = null;
  
  const mapContainer = document.getElementById("mapContainer");
  const dataPanel = document.getElementById("dataPanel");
  const compareBtn = document.getElementById("compareBtn");
  const modeText = document.getElementById("modeText");
  const countySelect = document.getElementById("countySelect");
  
  function renderMap(county) {
    mapContainer.innerHTML = `<img src="${county}-map.jpg" alt="${county} åœ°åœ–">`;
  
    schools[county].forEach(school => {
      const btn = document.createElement("button");
      btn.classList.add("area-btn", school.type);
      if (county === "yunlin") btn.classList.add("yunlin-dot");
      if (county === "taipei") btn.classList.add("taipei-dot");
  
      btn.style.top = school.pos.top;
      btn.style.left = school.pos.left;
      btn.title = school.name;
  
      btn.addEventListener("click", () => {
        btn.classList.add("active-click");
        setTimeout(() => btn.classList.remove("active-click"), 300);
  
        if (!compareMode) {
          selectedRural = school.type === "rural" ? school : null;
          selectedCity = school.type === "city" ? school : null;
          modeText.textContent = `ç•¶å‰é¸æ“‡ï¼š${school.name}`;
          displaySchoolData();
        } else {
          if (school.type === "rural") {
            selectedRural = school;
            modeText.textContent = "è«‹é¸æ“‡éƒ½å¸‚å­¸æ ¡é€²è¡Œæ¯”å°";
          }
          if (school.type === "city") {
            selectedCity = school;
            modeText.textContent = "æ¯”å°å®Œæˆ";
          }
          displaySchoolData();
        }
      });
  
      mapContainer.appendChild(btn);
    });
  }
  
  function displaySchoolData() {
    dataPanel.innerHTML = "";
  
    function createInfoCard(school, labelClass = "") {
      const div = document.createElement("div");
      div.innerHTML = `<h3>${school.name}</h3>`;
  
      // é¡¯ç¤ºè€å¸«æ•¸é‡è¼¸å…¥æ¬„
      div.innerHTML += `
        <label>è€å¸«æ•¸é‡ï¼š
          <input type="number" min="1" value="${school.teacher}" id="teacherInput" style="width: 60px; margin-left: 10px;">
        </label>
      `;
  
      const dataKeys = {
        student: "å­¸ç”Ÿæ•¸é‡",
        graduates: "ç•¢æ¥­ç”Ÿæ•¸é‡"
      };
      for (const key in dataKeys) {
        const val = school[key];
        div.innerHTML += `
          <label>${dataKeys[key]}ï¼š${val}</label>
          <div class="bar"><span class="${labelClass}" style="width:${Math.min((val / 1000) * 100, 100)}%"></span></div>
        `;
      }
  
      // ç•¢æ¥­ç‡
      function updateGraduationRate() {
        const teacherInput = div.querySelector("#teacherInput");
        let teacherNum = parseInt(teacherInput.value) || school.teacher;
        // èª¿æ•´ç•¢æ¥­ç‡å…¬å¼ï¼šæŒ‰è€å¸«æ•¸æ¯”ä¾‹å¢æ¸›
        let baseRate = school.graduates / school.student;
        let newRate = Math.min(1, baseRate * (teacherNum / school.teacher));
        div.querySelector(".rate-text").textContent = `ğŸ“ ç•¢æ¥­ç‡ï¼š${(newRate*100).toFixed(1)}%`;
      }
  
      const rate = (school.graduates / school.student) * 100;
      div.innerHTML += `<p class="rate-text">ğŸ“ ç•¢æ¥­ç‡ï¼š${rate.toFixed(1)}%</p>`;
  
      // ç›£è½è€å¸«æ•¸é‡è¼¸å…¥è®ŠåŒ–
      const teacherInput = div.querySelector("#teacherInput");
      teacherInput.addEventListener("input", updateGraduationRate);
  
      return div;
    }
  
    if (selectedRural) dataPanel.appendChild(createInfoCard(selectedRural));
    if (selectedCity) dataPanel.appendChild(createInfoCard(selectedCity, "city"));
  }
  
  compareBtn.addEventListener("click", () => {
    compareMode = !compareMode;
    compareBtn.textContent = compareMode ? "çµæŸæ¯”å°æ¨¡å¼" : "é–‹å§‹æ¯”å°æ¨¡å¼";
    selectedRural = null;
    selectedCity = null;
    dataPanel.innerHTML = "";
    modeText.textContent = compareMode ? "æ¯”å°æ¨¡å¼å•Ÿå‹•ï¼šè«‹å…ˆé¸æ“‡åé„‰å­¸æ ¡" : "é»æ“Šåœ°åœ–ä¸Šçš„å­¸æ ¡æŸ¥çœ‹è³‡æ–™";
  });
  
  countySelect.addEventListener("change", (e) => {
    const county = e.target.value;
    dataPanel.innerHTML = "";
  
    if (compareMode) {
      renderMap(county);
      if (!selectedRural && county === "yunlin") {
        modeText.textContent = "æ¯”å°æ¨¡å¼å•Ÿå‹•ä¸­ï¼šè«‹é¸æ“‡åé„‰å­¸æ ¡";
      } else if (!selectedCity && county === "taipei") {
        modeText.textContent = "æ¯”å°æ¨¡å¼å•Ÿå‹•ä¸­ï¼šè«‹é¸æ“‡éƒ½å¸‚å­¸æ ¡";
      } else {
        modeText.textContent = "æ¯”å°æ¨¡å¼ï¼šå¯ç¹¼çºŒé¸æ“‡å¦ä¸€ç¸£å¸‚å­¸æ ¡";
      }
    } else {
      selectedRural = null;
      selectedCity = null;
      modeText.textContent = "é»æ“Šåœ°åœ–ä¸Šçš„å­¸æ ¡æŸ¥çœ‹è³‡æ–™";
      renderMap(county);
    }
  });
  
  // é è¨­è¼‰å…¥
  renderMap(countySelect.value);
</script>


</body>
</html>
