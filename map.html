<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>整合互動地圖 - 偏鄉教育資源</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<main class="map-main">
  <!-- 左側資訊卡片 -->
  <section class="card" id="infoCard">
    <h2>互動地圖</h2>
    <p id="modeText">點擊地圖上的學校查看資料</p>
    <div id="dataPanel"></div>
    <button id="compareBtn">開始比對模式</button>
  </section>

  <!-- 右側地圖 -->
  <section class="map-container" id="mapContainer">
    <img src="yunlin-map.jpg" alt="地圖">
  </section>
</main>

<!-- 導覽列 -->
<nav class="navbar">
  <ul>
    <li><a href="index.html">🏠</a></li>
    <li><a href="about.html">🎯</a></li>
    <li><a href="data.html">📊</a></li>
    <li><a href="map.html" class="active">🗺️</a></li>
    <li><a href="feedback.html">💬</a></li>
  </ul>
</nav>

<script>
const schools = {
  "A": { type: "rural", name: "偏鄉高中 C", teacher: 28, internet: 60, baseGraduates: 50, pos:{top:"70%", left:"70%"} },
  "B": { type: "city", name:  "都市高中 D", teacher: 18, internet: 95, baseGraduates: 80, pos:{top:"25%", left:"65%"} }
};

let compareMode = false;
let selectedRural = null;
let selectedCity = null;

const mapContainer = document.getElementById("mapContainer");
const dataPanel = document.getElementById("dataPanel");
const compareBtn = document.getElementById("compareBtn");
const modeText = document.getElementById("modeText");

// 生成地圖點
for (const key in schools){
  const school = schools[key];
  const btn = document.createElement("button");
  btn.classList.add("area-btn");
  btn.classList.add(school.type);
  btn.style.top = school.pos.top;
  btn.style.left = school.pos.left;
  btn.title = school.name;
  mapContainer.appendChild(btn);

  btn.addEventListener("click", () => {
    btn.classList.add("active-click");
    setTimeout(() => btn.classList.remove("active-click"), 300);

    if (!compareMode){
      selectedRural = school.type==="rural" ? school : null;
      selectedCity = school.type==="city" ? school : null;
      modeText.textContent = `當前選擇：${school.name}`;
      displaySchoolData();
    } else {
      if(school.type==="rural") {
        selectedRural = school;
        modeText.textContent = "請選擇都市學校進行比對";
      }
      if(school.type==="city") {
        selectedCity = school;
        modeText.textContent = "比對完成";
      }
      displaySchoolData();
    }
  });
}

// 比對模式按鈕
compareBtn.addEventListener("click", () => {
  compareMode = !compareMode;
  compareBtn.textContent = compareMode ? "結束比對模式" : "開始比對模式";
  selectedRural = null;
  selectedCity = null;
  dataPanel.innerHTML = "";
  modeText.textContent = compareMode ? "比對模式啟動：請先選擇偏鄉學校" : "點擊地圖上的學校查看資料";
});

// 顯示資料面板
function displaySchoolData(){
  dataPanel.innerHTML = "";

  function calculateGraduates(base, teacherValue, internetValue){
    // 師生比加成（理想師生比 18）
    const idealTeacher = 18;
    const alpha = 0.3; // 師生比影響係數
    let teacherFactor = 1 - Math.min(Math.max((teacherValue - idealTeacher)/idealTeacher * alpha, -0.3), 0.3);

    // 網路覆蓋率加成
    const baseInternet = 60; // 基準網路覆蓋率
    const beta = 0.25;
    let internetFactor = 1 + (internetValue - baseInternet)/100 * beta;

    let graduates = base * teacherFactor * internetFactor;
    return Math.round(graduates);
  }

  // 偏鄉學校
  if(selectedRural){
    const div = document.createElement("div");
    div.innerHTML = `<h3>${selectedRural.name}</h3>
      <label>師生比</label>
      <input type="range" min="10" max="50" value="${selectedRural.teacher}" id="teacherInput">
      <div class="progress-bar"><div class="progress-fill" id="teacherBar"></div></div>
      <p id="teacherText">目前模擬值：1:${selectedRural.teacher}</p>
      <label>網路覆蓋率</label>
      <input type="range" min="30" max="95" value="${selectedRural.internet}" id="internetInput">
      <div class="progress-bar"><div class="progress-fill" id="internetBar"></div></div>
      <p id="internetText">目前模擬值：${selectedRural.internet}%</p>
      <label>畢業人數</label>
      <div class="progress-bar"><div class="progress-fill" id="graduationBar"></div></div>
      <p id="graduationText">目前模擬值：${selectedRural.baseGraduates}</p>`;
    dataPanel.appendChild(div);

    const teacherInput = document.getElementById("teacherInput");
    const internetInput = document.getElementById("internetInput");
    const teacherBar = document.getElementById("teacherBar");
    const internetBar = document.getElementById("internetBar");
    const graduationBar = document.getElementById("graduationBar");
    const teacherText = document.getElementById("teacherText");
    const internetText = document.getElementById("internetText");
    const graduationText = document.getElementById("graduationText");

    function updateBars(){
      const teacherValue = parseInt(teacherInput.value);
      const internetValue = parseInt(internetInput.value);

      teacherBar.style.width = (teacherValue/50*100)+"%";
      teacherText.textContent = "目前模擬值：1:"+teacherValue;

      internetBar.style.width = internetValue+"%";
      internetText.textContent = "目前模擬值："+internetValue+"%";

      const graduates = calculateGraduates(selectedRural.baseGraduates, teacherValue, internetValue);
      graduationBar.style.width = Math.min(graduates/selectedRural.baseGraduates*100, 100)+"%";
      graduationText.textContent = "目前模擬值："+graduates+" 人";
    }

    teacherInput.addEventListener("input", updateBars);
    internetInput.addEventListener("input", updateBars);
    updateBars();
  }

  // 都市學校
  if(selectedCity){
    const div = document.createElement("div");
    div.innerHTML = `<h3>${selectedCity.name}</h3>
      <label>師生比：${selectedCity.teacher}</label>
      <div class="progress-bar"><div class="progress-fill city" style="width:${selectedCity.teacher/50*100}%"></div></div>
      <label>網路覆蓋率：${selectedCity.internet}%</label>
      <div class="progress-bar"><div class="progress-fill city" style="width:${selectedCity.internet}%"></div></div>
      <label>畢業人數：${selectedCity.baseGraduates}</label>
      <div class="progress-bar"><div class="progress-fill city" style="width:${selectedCity.baseGraduates/selectedCity.baseGraduates*100}%"></div></div>`;
    dataPanel.appendChild(div);
  }
}
</script>

</body>
</html>
