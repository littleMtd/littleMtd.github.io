<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ•´åˆäº’å‹•åœ°åœ– - åé„‰æ•™è‚²è³‡æº</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<main class="map-main">
  <!-- å·¦å´è³‡è¨Šå¡ç‰‡ -->
  <section class="card" id="infoCard">
    <h2>äº’å‹•åœ°åœ–</h2>
    <p id="modeText">é»æ“Šåœ°åœ–ä¸Šçš„å­¸æ ¡æŸ¥çœ‹è³‡æ–™</p>
    <div id="dataPanel"></div>
    <button id="compareBtn">é–‹å§‹æ¯”å°æ¨¡å¼</button>
  </section>

  <!-- å³å´åœ°åœ– -->
  <section class="map-container" id="mapContainer">
    <img src="yunlin-map.jpg" alt="åœ°åœ–">
  </section>
</main>

<!-- å°è¦½åˆ— -->
<nav class="navbar">
  <ul>
    <li><a href="index.html">ğŸ </a></li>
    <li><a href="about.html">ğŸ¯</a></li>
    <li><a href="data.html">ğŸ“Š</a></li>
    <li><a href="map.html" class="active">ğŸ—ºï¸</a></li>
    <li><a href="feedback.html">ğŸ’¬</a></li>
  </ul>
</nav>

<script>
const schools = {
  "A": { type: "rural", name: "åé„‰é«˜ä¸­ C", teacher: 28, internet: 60, baseGraduates: 50, pos:{top:"70%", left:"70%"} },
  "B": { type: "city", name:  "éƒ½å¸‚é«˜ä¸­ D", teacher: 18, internet: 95, baseGraduates: 80, pos:{top:"25%", left:"65%"} }
};

let compareMode = false;
let selectedRural = null;
let selectedCity = null;

const mapContainer = document.getElementById("mapContainer");
const dataPanel = document.getElementById("dataPanel");
const compareBtn = document.getElementById("compareBtn");
const modeText = document.getElementById("modeText");

// ç”Ÿæˆåœ°åœ–é»
for (const key in schools){
  const school = schools[key];
  const btn = document.createElement("button");
  btn.classList.add("area-btn");
  btn.classList.add(school.type);
  btn.style.top = school.pos.top;
  btn.style.left = school.pos.left;
  btn.title = school.name;
  mapContainer.appendChild(btn);

  btn.addEventListener("click", () => {
    btn.classList.add("active-click");
    setTimeout(() => btn.classList.remove("active-click"), 300);

    if (!compareMode){
      selectedRural = school.type==="rural" ? school : null;
      selectedCity = school.type==="city" ? school : null;
      modeText.textContent = `ç•¶å‰é¸æ“‡ï¼š${school.name}`;
      displaySchoolData();
    } else {
      if(school.type==="rural") {
        selectedRural = school;
        modeText.textContent = "è«‹é¸æ“‡éƒ½å¸‚å­¸æ ¡é€²è¡Œæ¯”å°";
      }
      if(school.type==="city") {
        selectedCity = school;
        modeText.textContent = "æ¯”å°å®Œæˆ";
      }
      displaySchoolData();
    }
  });
}

// æ¯”å°æ¨¡å¼æŒ‰éˆ•
compareBtn.addEventListener("click", () => {
  compareMode = !compareMode;
  compareBtn.textContent = compareMode ? "çµæŸæ¯”å°æ¨¡å¼" : "é–‹å§‹æ¯”å°æ¨¡å¼";
  selectedRural = null;
  selectedCity = null;
  dataPanel.innerHTML = "";
  modeText.textContent = compareMode ? "æ¯”å°æ¨¡å¼å•Ÿå‹•ï¼šè«‹å…ˆé¸æ“‡åé„‰å­¸æ ¡" : "é»æ“Šåœ°åœ–ä¸Šçš„å­¸æ ¡æŸ¥çœ‹è³‡æ–™";
});

// é¡¯ç¤ºè³‡æ–™é¢æ¿
function displaySchoolData(){
  dataPanel.innerHTML = "";

  function calculateGraduates(base, teacherValue, internetValue){
    // å¸«ç”Ÿæ¯”åŠ æˆï¼ˆç†æƒ³å¸«ç”Ÿæ¯” 18ï¼‰
    const idealTeacher = 18;
    const alpha = 0.3; // å¸«ç”Ÿæ¯”å½±éŸ¿ä¿‚æ•¸
    let teacherFactor = 1 - Math.min(Math.max((teacherValue - idealTeacher)/idealTeacher * alpha, -0.3), 0.3);

    // ç¶²è·¯è¦†è“‹ç‡åŠ æˆ
    const baseInternet = 60; // åŸºæº–ç¶²è·¯è¦†è“‹ç‡
    const beta = 0.25;
    let internetFactor = 1 + (internetValue - baseInternet)/100 * beta;

    let graduates = base * teacherFactor * internetFactor;
    return Math.round(graduates);
  }

  // åé„‰å­¸æ ¡
  if(selectedRural){
    const div = document.createElement("div");
    div.innerHTML = `<h3>${selectedRural.name}</h3>
      <label>å¸«ç”Ÿæ¯”</label>
      <input type="range" min="10" max="50" value="${selectedRural.teacher}" id="teacherInput">
      <div class="progress-bar"><div class="progress-fill" id="teacherBar"></div></div>
      <p id="teacherText">ç›®å‰æ¨¡æ“¬å€¼ï¼š1:${selectedRural.teacher}</p>
      <label>ç¶²è·¯è¦†è“‹ç‡</label>
      <input type="range" min="30" max="95" value="${selectedRural.internet}" id="internetInput">
      <div class="progress-bar"><div class="progress-fill" id="internetBar"></div></div>
      <p id="internetText">ç›®å‰æ¨¡æ“¬å€¼ï¼š${selectedRural.internet}%</p>
      <label>ç•¢æ¥­äººæ•¸</label>
      <div class="progress-bar"><div class="progress-fill" id="graduationBar"></div></div>
      <p id="graduationText">ç›®å‰æ¨¡æ“¬å€¼ï¼š${selectedRural.baseGraduates}</p>`;
    dataPanel.appendChild(div);

    const teacherInput = document.getElementById("teacherInput");
    const internetInput = document.getElementById("internetInput");
    const teacherBar = document.getElementById("teacherBar");
    const internetBar = document.getElementById("internetBar");
    const graduationBar = document.getElementById("graduationBar");
    const teacherText = document.getElementById("teacherText");
    const internetText = document.getElementById("internetText");
    const graduationText = document.getElementById("graduationText");

    function updateBars(){
      const teacherValue = parseInt(teacherInput.value);
      const internetValue = parseInt(internetInput.value);

      teacherBar.style.width = (teacherValue/50*100)+"%";
      teacherText.textContent = "ç›®å‰æ¨¡æ“¬å€¼ï¼š1:"+teacherValue;

      internetBar.style.width = internetValue+"%";
      internetText.textContent = "ç›®å‰æ¨¡æ“¬å€¼ï¼š"+internetValue+"%";

      const graduates = calculateGraduates(selectedRural.baseGraduates, teacherValue, internetValue);
      graduationBar.style.width = Math.min(graduates/selectedRural.baseGraduates*100, 100)+"%";
      graduationText.textContent = "ç›®å‰æ¨¡æ“¬å€¼ï¼š"+graduates+" äºº";
    }

    teacherInput.addEventListener("input", updateBars);
    internetInput.addEventListener("input", updateBars);
    updateBars();
  }

  // éƒ½å¸‚å­¸æ ¡
  if(selectedCity){
    const div = document.createElement("div");
    div.innerHTML = `<h3>${selectedCity.name}</h3>
      <label>å¸«ç”Ÿæ¯”ï¼š${selectedCity.teacher}</label>
      <div class="progress-bar"><div class="progress-fill city" style="width:${selectedCity.teacher/50*100}%"></div></div>
      <label>ç¶²è·¯è¦†è“‹ç‡ï¼š${selectedCity.internet}%</label>
      <div class="progress-bar"><div class="progress-fill city" style="width:${selectedCity.internet}%"></div></div>
      <label>ç•¢æ¥­äººæ•¸ï¼š${selectedCity.baseGraduates}</label>
      <div class="progress-bar"><div class="progress-fill city" style="width:${selectedCity.baseGraduates/selectedCity.baseGraduates*100}%"></div></div>`;
    dataPanel.appendChild(div);
  }
}
</script>

</body>
</html>
